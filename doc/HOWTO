Setting up statistics gathering on a new machine. (*** Work in progress. ***)

0. Spin up a fresh GENI VM. (Using Ubuntu in this example.) Then do the following.

1. Clone statistics code from git repo and set up dependencies.
git clone https://github.com/colleagueoftheprophetoffloyd/PGstatistics.git statistics
sudo apt-get -y install python-m2crypto python-mysqldb

2. Need a mysql installation. Docker seems to cover it adequately, and we'll install docker with ansible.

2a. Install ansible.
sudo apt-get -y install ansible

2b. Run ansible playbook to install docker.
ansible-playbook -i "localhost," -c local statistics/install-stuff/ansible/docker.yml

*** Docker installation changes group access. Log out and log back in now.
*** Check that docker's working OK.
docker run hello-world

2c. Start a docker mysql container
docker run --name stats-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=***Password-goes-here*** -d mysql

2d. Set up mysql defaults.
Put the following into ~/.my.cnf
[client]
user=root
password=***Password goes here***
protocol=TCP
port=3306

3. Initialize mysql databases.
sudo apt-get -y install mysql-client

mysql
create database protogeniHistory;
exit

Now add line "database=protogeniHistory" to end of ~/.my.cnf

mysql < ~/statistics/ProtogeniHistoryAnalysis/initializeRecordsTable.sql

4. Set up credentials. Put these two files in .ssl:
meb-emulab-special-cred.txt
utah-emulab-cleartext.pem

[The first must be obtained from Leigh. 
The second can be created by downloading Emulab credential pack from Emulab site,
getting an unencrypted version of the private key with "openssl rsa -in *credential-pack-file*",
and replacing the encrypted key with the resulting output.]


